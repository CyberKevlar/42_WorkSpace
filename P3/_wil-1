# ESTOS COMANDOS HAY QUE APLICARLOS EN LA CONSOLA DEL SWITCH_1 PARA MODO ESTATICO

# Consola de frrouting, para contruir la BGP:
vtysh

# A partir de aqui TODO seran comandos de frrouting, ya que es el router que hace de nodo:
# Abrimos "terminal" de configuracion:
conf t

# Configuramos el adaptador "eth1", que va a al "eth1" del router-2.
# Asignamos una IP a la eth del router nodo, y la asignamos a OSPF area 0 (protocolo???):
# Hacemos esto mismo para las otras 2 interfaces y con la local/loopback.
# Esta ultima la usaremos para BGP update-source y router-id.
interface eth1
ip address 10.1.1.1/30
ip ospf area 0
interface eth2
ip address 10.1.1.5/30
ip ospf area 0
interface eth3
ip address 10.1.1.9/30
ip ospf area 0
interface lo
ip address 10.255.255.1/32
ip ospf area 0

# (???)
router ospf
router-id 10.255.255.1

# Configuramos el protocolo de enrutamiento BGP con el AS numero 1 (nos metera en otra subterminal): 
router bgp 1
bgp router-id 10.255.255.1

# Creamos los grupos ibgp "peer-group", que vamos a usar para configurar el comportamiento de las sesiones BGP con los demas routers:
neighbor ibgp peer-group

# (???)
neighbor ibgp remote-as 1

# La interfaz de loopback es la que usaremos de actualizacion para establecer la sesion BGP:
neighbor ibgp update-source lo

# La configuracion de BGP usuar√° un rango de IP para el peer-group que creamos antes.
# Esto es para escuchar los grupos dentro del rango de loopbacks de los otros routers.
# (OJO CON LAS IPS, MUCHOS RANGOS Y MASCARAS DISTINTAS, REVISAR!)
# NOTA: con la mascara de red /24 permitimos que cualquier router con una direccion de loopback con
# ese rango se empareje en auto.
bgp listen range 10.255.255.0/24 peer-group ibgp

# Activamos la "address-family" (???) para la L2VPN EVPN (???)
address-family l2vpn evpn

# Activamos los neighbor y configuramos como si fuera un "route-reflector client":
neighbor ibgp activate
neighbor ibgp route-reflector-client

# Salimos de las subterminales:
exit
